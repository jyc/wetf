!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i("undefined"!=typeof globalThis?globalThis:t||self)}(this,function(t){"use strict";t=t.Wetf||(t.Wetf={});t.Packer=class{constructor(t={}){if(this.t=t.compression??!1,this.i=["string","binary"].indexOf(t.encoding?.string?.toLowerCase()??"")+1||1,this.h=["atom","binary","string"].indexOf(t.encoding?.key?.toLowerCase()??"")+1||1,this.l=["bigint","float"].indexOf(t.encoding?.safeInt?.toLowerCase()??"")+1||1,this.o=["number","bigint"].indexOf(t.encoding?.safeBigInt?.toLowerCase()??"")+1||1,this.u=["atom","nil"].indexOf(t.encoding?.null?.toLowerCase()??"")+1||1,this.v=["binary","bitbinary","string"].indexOf(t.encoding?.buffer?.toLowerCase()??"")+1||1,this.m=["atom","null","ignore"].indexOf(t.encoding?.undefined?.toLowerCase()??"")+1||1,this.p=["atom","null","ignore"].indexOf(t.encoding?.infinity?.toLowerCase()??"")+1||1,this.g=["atom","null","ignore"].indexOf(t.encoding?.nan?.toLowerCase()??"")+1||1,this.k=["list","improperlist","tuple"].indexOf(t.encoding?.array?.toLowerCase()??"")+1||3,this.N=Boolean(t.useLegacyAtoms),this.A=Number(t.poolSize)||1048576,this.U=new Uint8Array(this.A),this.B=new DataView(this.U.buffer),this.j=0,this.D=0,this.S=0,"undefined"!=typeof process&&"string"==typeof process?.versions?.node)this.T=Buffer.from(this.U.buffer),this.V=(t,i)=>this.T.write(t,i),this.I=32,!0===this.t&&(this.t="zlib");else{const s=new TextEncoder;this.V=(t,i)=>s.encodeInto(t,this.U.subarray(i)).written??0,this.T=null,this.I=32,!0===this.t&&(this.t="compressionstream"),"object"==typeof navigator&&((t=navigator.userAgent).includes("Firefox")?this.I=128:t.includes("Chrome")&&(this.I=540))}if(this.t)if("zlib"===this.t){const i=require("zlib");this.q=t=>(t=i.deflateSync(t),this.C(t))}else if("compressionstream"===this.t)this.q=t=>{var i=new CompressionStream("deflate"),s=i.readable.getReader();const h=i.writable.getWriter();return h.ready.then(()=>h.write(t)).then(()=>h.ready).then(()=>h.close()),this.F(s)};else if("function"==typeof this.t){const h=this.t;this.q=t=>(t=h(t))instanceof Promise?t.then(this.C):this.C(t)}}pack(t){var i;return this.D=this.j,this.S=0,this.M(10),this.q?(this.O(t),i=this.U.subarray(this.D,this.j),this.q(i)):(this.U[this.j++]=131,this.O(t),this.U.subarray(this.D,this.j))}O(h){var t=typeof h;switch(t){case"undefined":3!==this.m&&(this.M(11),this.U[this.j]=this.N?115:119,this.U[this.j+1]=9,this.U[this.j+2]=117,this.B.setUint32(this.j+3,1852073318),this.B.setUint32(this.j+7,1768842596),this.j+=11);break;case"boolean":this.M(7),this.U[this.j]=this.N?115:119,h?(this.U[this.j+1]=4,this.B.setUint32(this.j+2,1953658213),this.j+=6):(this.U[this.j+1]=5,this.U[this.j+2]=102,this.B.setUint32(this.j+3,1634497381),this.j+=7);break;case"string":case"symbol":"symbol"==t&&(h=h.toString()),2===this.i?(this.M(2*h.length+5),this.U[this.j++]=109,e=this.j,this.j+=4,v=this.P(h),this.B.setUint32(e,v)):(this.M(2*h.length+3),this.U[this.j++]=107,e=this.j,this.j+=2,v=this.P(h),this.U[e]=v>>8,this.U[e+1]=255&v);break;case"number":if(Number.isFinite(h))this.M(11),Number.isInteger(h)?(e=Math.abs(h),v=h<0,h<256&&!v?(this.U[this.j++]=97,this.U[this.j++]=h):e<2147483648?(this.U[this.j]=98,this.B.setInt32(this.j+1,h),this.j+=5):e<=Number.MAX_SAFE_INTEGER&&1===this.l?(this.U[this.j]=110,this.U[this.j+2]=Number(v),e<4294967296?(this.B.setUint32(this.j+3,e,!0),this.U[this.j+1]=4,this.j+=7):(v=e>>>0,e=Math.floor(e/4294967296),this.B.setUint32(this.j+3,v,!0),e<256?(this.U[this.j+1]=5,this.U[this.j+7]=e,this.j+=8):e<65536?(this.U[this.j+1]=6,this.U[this.j+7]=255&e,this.U[this.j+8]=e>>8,this.j+=9):(this.U[this.j+1]=7,this.U[this.j+7]=255&e,this.U[this.j+8]=e>>8&255,this.U[this.j+9]=e>>16,this.j+=10))):(this.U[this.j++]=70,this.B.setFloat64(this.j,h),this.j+=8)):(this.U[this.j++]=70,this.B.setFloat64(this.j,h),this.j+=8);else if(Number.isNaN(h)){if(3===this.g)break;this.M(4),this.U[this.j]=this.N?115:119,this.U[this.j+1]=110,this.U[this.j+2]=97,this.U[this.j+3]=110,this.j+=4}else{if(3===this.p)break;this.M(18),this.U[this.j]=this.N?115:119,h<0?this.B.setUint32(this.j+1,1852139361):this.B.setUint32(this.j+1,1886352233),this.U[this.j+5]=95,this.B.setUint32(this.j+6,1769366879),this.B.setUint32(this.j+10,1768842857),this.B.setUint32(this.j+14,1852404857),this.j+=18}break;case"bigint":if(0n===h)this.M(3),2===this.o?(this.U[this.j++]=110,this.U[this.j++]=0):this.U[this.j++]=97,this.U[this.j++]=0;else{var e=(v=h<0n)?-h:h;if(e<18446744073709551616n)if(this.M(11),1===this.o&&e<2147483648n)e<256n&&!v?(this.U[this.j++]=97,this.B.setBigUint64(this.j++,e)):(this.U[this.j++]=98,this.B.setBigUint64(this.j,e),v&&(o=this.U[this.j],this.U[this.j]=128|o),this.j+=4);else{this.U[this.j]=110,this.U[this.j+2]=Number(v),this.B.setBigUint64(this.j+3,e,!0);for(let t=10;3<t;t--)if(0!==this.U[this.j+t]){this.U[this.j+1]=t-2,this.j+=t+1;break}}else if(e<340282366920938463463374607431768211456n){this.M(19),this.U[this.j]=110,this.U[this.j+2]=Number(v),this.B.setBigUint64(this.j+3,18446744073709551615n&e,!0),this.B.setBigUint64(this.j+11,e>>64n,!0);for(let t=18;11<t;t--)if(0!==this.U[this.j+t]){this.U[this.j+1]=t-2,this.j+=t+1;break}}else if(e<115792089237316195423570985008687907853269984665640564039457584007913129639936n){this.M(35),this.U[this.j]=110,this.U[this.j+2]=Number(v),this.B.setBigUint64(this.j+3,18446744073709551615n&e,!0),this.B.setBigUint64(this.j+11,e>>64n&18446744073709551615n,!0),this.B.setBigUint64(this.j+19,e>>128n&18446744073709551615n,!0),this.B.setBigUint64(this.j+27,e>>192n,!0);for(let t=34;27<t;t--)if(0!==this.U[this.j+t]){this.U[this.j+1]=t-2,this.j+=t+1;break}}else{let t=e;for(var i=[];;){var s=(r=115792089237316195423570985008687907853269984665640564039457584007913129639935n&t)>>128n,r=340282366920938463463374607431768211455n&r;if(!(t>>=256n)){var n=18446744073709551615n&r,a=r>>64n,f=18446744073709551615n&s,l=s>>64n;0n<l?i.push(n,a,f,l):0n<f?i.push(n,a,f):0n<a?i.push(n,a):i.push(n);break}i.push(18446744073709551615n&r,r>>64n,18446744073709551615n&s,s>>64n)}var o=8*i.length;this.M(6+o),o<256?(this.U[this.j]=110,this.U[this.j+1]=o,this.U[this.j+2]=Number(v),this.j+=3):(this.U[this.j]=111,this.B.setUint32(this.j+1,o),this.U[this.j+5]=Number(v),this.j+=6);for(let t=0;t<i.length;t++){var u=i[t],c=this.j+8*t;this.B.setBigUint64(c,u,!0)}this.j+=o}}break;case"object":if(null===h)this.M(5),2===this.u?this.U[this.j++]=106:(this.U[this.j]=this.N?115:119,this.B.setUint32(this.j+1,57567596),this.j+=5);else if(Array.isArray(h))if(this.M(5),0===h.length)3===this.k?(this.U[this.j++]=104,this.U[this.j++]=0):this.U[this.j++]=106;else{let s=h.length,t=this.j+1,i=1;e=this.S,3===this.k?h.length<256?(this.U[this.j]=104,this.j+=2):(this.U[this.j]=105,this.j+=5,i=2):(this.U[this.j]=108,this.j+=5,i=2===this.k?(s--,3):4);for(let i=0;i<h.length;i++){let t=h[i];var b=this.G(t);if(!b){if(null!==b){s--;continue}t=null}this.O(t)}switch(e!==this.S&&(t-=this.S),i){case 1:this.U[t]=s;break;case 2:case 3:this.B.setUint32(t,s);break;case 4:this.B.setUint32(t,s),this.U[this.j++]=106}}else if(ArrayBuffer.isView(h)){var v,o=(v=1!==h.BYTES_PER_ELEMENT?new Uint8Array(h.buffer,h.byteOffset,h.byteLength):h).length;let t=!1;3===this.v?(this.M(o+3),this.U[this.j]=107,this.U[this.j+1]=o>>8,this.U[this.j+2]=255&o,this.j+=3):2===this.v?(this.M(o+6),this.U[this.j]=77,this.B.setUint32(this.j+1,o),this.U[this.j+5]=0,this.j+=6,t=!0):(this.M(o+5),this.U[this.j]=109,this.B.setUint32(this.j+1,o),this.j+=5),o&&(this.U.set(v,this.j),t)&&(e=this.U[this.j+o-1],v=Math.floor(Math.log2(e)+1),this.U[this.j+o-1]=e<<8-v,this.U[this.j-1]=v),this.j+=o}else{this.M(6),this.U[this.j++]=116;var y=Object.keys(h);let s=y.length,t=this.j;e=this.S,this.j+=4;for(let i=0;i<y.length;i++){var m=y[i];let t=h[m];if(!(p=this.G(t))){if(null!==p){s--;continue}t=null}var w=m.length;if(1===this.h&&this.N){w<256?(this.M(w+2),this.U[this.j++]=115,this.U[this.j++]=w):(this.M(w+3),this.U[this.j++]=100,this.U[this.j++]=w>>8,this.U[this.j++]=255&w);for(let t=0;t<w;t++)this.U[this.j++]=m.charCodeAt(t)}else{this.M(5+(p=2*w)),d=2===this.h?(this.U[this.j]=109,4):3===this.h?(this.U[this.j]=107,2):p<256?(this.U[this.j]=119,1):(this.U[this.j]=118,2);var d,p=this.j+1,g=(this.j+=1+d,this.P(m));1==d?this.U[p]=g:2==d?(this.U[p]=g>>8,this.U[p+1]=255&g):this.B.setUint32(p,g)}this.O(t)}e!==this.S&&(t-=this.S),this.B.setUint32(t,s)}}}G(t){var i=typeof t;if("undefined"==i){if(2===this.m)return null;if(3===this.m)return!1}if("number"==i&&!Number.isFinite(t))if(Number.isNaN(t)){if(2===this.g)return null;if(3===this.g)return!1}else{if(2===this.p)return null;if(3===this.p)return!1}return!0}M(t){if(this.j+t>=this.A){let t;0===this.D?(this.A*=2,t=this.U,this.U=new Uint8Array(this.A)):(t=this.U.subarray(this.D,this.j),this.U=new Uint8Array(this.A),this.j=t.length,this.S=this.D,this.D=0),this.B=new DataView(this.U.buffer),this.T&&(this.T=Buffer.from(this.U.buffer)),this.U.set(t)}}P(i){var s=i.length;if(s<this.I){var t=this.j;for(let t=0;t<s;t++){var h=i.charCodeAt(t);h<128?this.U[this.j++]=h:(h<2048?this.U[this.j++]=192+(h>>6):(h<55296||57343<h?this.U[this.j++]=224+(h>>12):(h=65536+((1023&h)<<10)+(1023&i.charCodeAt(++t)),this.U[this.j++]=240+(h>>18),this.U[this.j++]=128+(h>>12&63)),this.U[this.j++]=128+(h>>6&63)),this.U[this.j++]=128+(63&h))}return this.j-t}return t=this.V(i,this.j),this.j+=t,t}C(t){var i=t.length,s=new Uint8Array(i+6);return s[0]=131,s[1]=80,s[2]=i>>24,s[3]=i>>16&255,s[4]=i>>8&255,s[5]=255&i,s.set(t,6),s}async F(t){var i=[];let s=0;for(;;){var{done:h,value:e}=await t.read();if(e&&(i.push(e),s+=e.length),h)break}var r=new Uint8Array(s+6);r[0]=131,r[1]=80,r[2]=s>>24,r[3]=s>>16&255,r[4]=s>>8&255,r[5]=255&s;let n=6;for(let t=0;t<i.length;t++){var a=i[t];r.set(a,n),n+=a.length}return r}},t.Unpacker=class{constructor(t={}){var i,s;this.t=t.decompression,this.i=["null","array"].indexOf(t.decoding?.h?.toLowerCase()??"")+1||1,this.o=["utf8","latin1","buffer","uint8array","array"].indexOf(t.decoding?.string?.toLowerCase()??"")+1||1,this.l=["utf8","latin1","buffer","uint8array","array"].indexOf(t.decoding?.binary?.toLowerCase()??"")+1||4,this.u=["utf8","latin1","buffer","uint8array","array"].indexOf(t.decoding?.bitbinary?.toLowerCase()??"")+1||4,this.m=["number","bigint","string"].indexOf(t.decoding?.safebigint?.toLowerCase()??"")+1||2,this.k=["bigint","string"].indexOf(t.decoding?.bigint?.toLowerCase()??"")+1||1,this.p=Boolean(t.atomRegistration??!0),"undefined"!=typeof process&&"string"==typeof process?.versions?.node?(s=new(i=require("node:string_decoder").StringDecoder)("utf8"),i=new i("latin1"),this.v=s.write.bind(s),this.B=i.write.bind(i),this.A=15,this.t||(this.t="zlib")):(s=new TextDecoder("utf8"),i=new TextDecoder("latin1"),this.v=s.decode.bind(s),this.B=i.decode.bind(i),this.A=32,"object"==typeof navigator&&((s=navigator.userAgent).includes("Firefox")?this.A=4:s.includes("Chrome")&&(this.A=200)),this.t||(this.t="decompressionstream")),this.C=new Uint8Array(0),this.j=new DataView(this.C.buffer,this.C.byteOffset,this.C.length),this.I=new Uint8Array(12e3),this.U=new DataView(this.I.buffer,this.I.byteOffset,this.I.length),this.g=0,this.P=t.atomTable??{true:!0,false:!1,undefined:void 0,null:null,h:null,T:NaN,S:1/0,G:1/0,F:-1/0};const n=new TextEncoder;this.M=Object.entries(this.P).reduce((t,i)=>{var[s,h]=i;let e=t[s.length]??=[];for(let t=0;t<s.length;t++){var r=s.charCodeAt(t);e=e[r]??=t===s.length-1?h:[]}return t},[]),this.N=Object.entries(this.P).reduce((t,i)=>{var[i,s]=i,h=n.encode(i);let e=t[h.length]??=[];for(let t=0;t<h.length;t++){var r=h[t];e=e[r]??=t===h.length-1?s:[]}return t},[])}unpack(t){var i=131===t[0]?1:0;if(80===t[i]){var s=(t[1+i]<<24)+(t[2+i]<<16)+(t[3+i]<<8)+t[4+i];const e=t.subarray(5+i,5+i+s);if("zlib"===this.t)return s=require("zlib").inflateSync(e),this.unpack(s);if("decompressionstream"===this.t){var h=(s=new DecompressionStream("deflate")).readable.getReader();const r=s.writable.getWriter();return r.ready.then(()=>r.write(e)).then(()=>r.ready).then(()=>r.close()),this.V(h).then(t=>this.unpack(t))}if("function"==typeof this.t)return(s=this.t(e))instanceof Promise?s.then(t=>this.unpack(t)):this.unpack(s)}return this.g=i,t.length<=this.I.length?(this.I.set(t),this.C=this.I,this.j=this.U):(this.C=t,this.j=new DataView(t.buffer,t.byteOffset,t.length)),this.O()}O(){var h=this.C[this.g++];switch(h){case 70:var s=this.j.getFloat64(this.g);return this.g+=8,s;case 97:return this.C[this.g++];case 98:s=this.j.getInt32(this.g);return this.g+=4,s;case 100:case 115:case 118:case 119:s=100===h||118===h?(this.C[this.g++]<<8)+this.C[this.g++]:this.C[this.g++];return this.q(s,h<118);case 104:case 105:case 108:{let i;104===h?i=this.C[this.g++]:(i=this.j.getUint32(this.g),this.g+=4);var e=Array(i);for(let t=0;t<i;t++)e[t]=this.O();return 108===h&&(106===this.C[this.g]?this.g++:e.push(this.O())),e}case 106:return 2===this.i?[]:null;case 107:case 109:case 77:{let i,t;if(107===h?(i=(this.C[this.g++]<<8)+this.C[this.g++],t=this.o):109===h?(i=this.j.getUint32(this.g),t=this.l,this.g+=4):(i=this.j.getUint32(this.g),t=this.u,s=this.C[this.g+4],n=this.C[this.g+i-1],this.C[this.g+i-1]=n>>8-s,this.g+=5),5!==t)return 2<t?(n=this.C.subarray(this.g,this.g+i),this.g+=i,(s=3===t?Buffer.allocUnsafe(i):new Uint8Array(i)).set(n),s):2===t?this.H(i):this.J(i);var r=Array(i);for(let t=0;t<i;t++)r[t]=this.C[this.g+t];return this.g+=i,r}case 110:case 111:{let i;if(110===h?i=this.C[this.g++]:(i=this.j.getUint32(this.g),this.g+=4),0===i)return this.g+=1,3===this.m?"0":1===this.m?0:0n;if(1===i&&0===this.C[this.g+1])return this.g+=2,3===this.m?"0":1===this.m?0:0n;var n=this.C[this.g++];if(i<7||7===i&&this.C[this.g+6]<32){let t=0;return t=1===i?this.C[this.g]:2===i?(this.C[this.g+1]<<8)+this.C[this.g]:3===i?(this.C[this.g+2]<<16)+(this.C[this.g+1]<<8)+this.C[this.g]:4===i?this.j.getUint32(this.g,!0):5===i?4294967296*this.C[this.g+4]+this.j.getUint32(this.g,!0):6===i?4294967296*((this.C[this.g+5]<<8)+this.C[this.g+4])+this.j.getUint32(this.g,!0):4294967296*((this.C[this.g+6]<<16)+(this.C[this.g+5]<<8)+this.C[this.g+4])+this.j.getUint32(this.g,!0),this.g+=i,n&&(t=-t),3===this.m?t.toString():1===this.m?t:BigInt(t)}let s;if(8===i)s=this.j.getBigUint64(this.g,!0);else{let t=i;for(s=0n;0<t;)8<=t?s=(s<<=64n)+this.j.getBigUint64(this.g+(t-=8),!0):4<=t?s=(s<<=32n)+BigInt(this.j.getUint32(this.g+(t-=4),!0)):2<=t?s=(s<<=16n)+BigInt(this.j.getUint16(this.g+(t-=2),!0)):(s=(s<<=8n)+BigInt(this.C[this.g]),t--)}return this.g+=i,n&&(s=-s),2===this.k?s.toString():s}case 116:var i={},a=this.j.getUint32(this.g);this.g+=4;for(let t=0;t<a;t++)i[this.O()]=this.O();return i}throw console.log(this.C.slice(this.g-20,this.g+20)),new Error("Unexpected byte: "+h)}q(h,t){var e=t?this.N:this.M;if(h in e){let i=e[h],s=this.g;for(let t=0;t<h;t++){var r=this.C[s++];if(!(r in i))break;if(t===h-1)return this.g+=h,i[r];i=i[r]}}return this.p?this._(h,t):t?this.J(h):this.H(h)}_(i,s){var t=s?this.N:this.M;i in t||(t[i]=[]);let h=t[i],e=this.g;for(let t=0;t<i;t++){var r=this.C[e++];h=r in h?h[r]:t===i-1?h[r]=s?this.J(i):this.H(i):h[r]=[]}return this.P[h]=h}J(t){let i="",s=this.g;var h=this.C;if(t<this.A)for(var e=s+t;s<e;){var r=this.C[s++];r<128?i+=String.fromCharCode(r):r<224?i+=String.fromCharCode(((31&r)<<6)+(63&h[s++])):r<240?i+=String.fromCharCode(((15&r)<<12)+((63&h[s++])<<6)+(63&h[s++])):(r=((7&r)<<18)+((63&h[s++])<<12)+((63&h[s++])<<6)+(63&h[s++]),i+=String.fromCharCode(55296+(r-65536>>10),55296+(r-65536&1023)))}else i=this.v(h.subarray(s,s+t));return this.g+=t,i}H(i){let s="";var h=this.g,e=this.C;if(i<this.A)for(let t=h;t<h+i;t++)s+=String.fromCharCode(e[t]);else s=this.B(e.subarray(h,h+i));return this.g+=i,s}async V(t){var i=[];let s=0;for(;;){var{done:h,value:e}=await t.read();if(e&&(i.push(e),s+=e.length),h)break}var r=new Uint8Array(s);let n=0;for(let t=0;t<i.length;t++){var a=i[t];r.set(a,n),n+=a.length}return r}}});