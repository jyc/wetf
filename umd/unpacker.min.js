!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i("undefined"!=typeof globalThis?globalThis:t||self)}(this,function(t){"use strict";(t.Wetf||(t.Wetf={})).Unpacker=class{constructor(t={}){var i,s;this.t=t.decompression,this.i=["null","array"].indexOf(t.decoding?.h?.toLowerCase()??"")+1||1,this.o=["utf8","latin1","buffer","uint8array","array"].indexOf(t.decoding?.string?.toLowerCase()??"")+1||1,this.u=["utf8","latin1","buffer","uint8array","array"].indexOf(t.decoding?.binary?.toLowerCase()??"")+1||4,this.l=["utf8","latin1","buffer","uint8array","array"].indexOf(t.decoding?.bitbinary?.toLowerCase()??"")+1||4,this.v=["number","bigint","string"].indexOf(t.decoding?.safebigint?.toLowerCase()??"")+1||2,this.g=["bigint","string"].indexOf(t.decoding?.bigint?.toLowerCase()??"")+1||1,this.p=Boolean(t.atomRegistration??!0),"undefined"!=typeof process&&"string"==typeof process?.versions?.node?(s=new(i=require("node:string_decoder").StringDecoder)("utf8"),i=new i("latin1"),this.m=s.write.bind(s),this.A=i.write.bind(i),this.B=15,this.t||(this.t="zlib")):(s=new TextDecoder("utf8"),i=new TextDecoder("latin1"),this.m=s.decode.bind(s),this.A=i.decode.bind(i),this.B=32,"object"==typeof navigator&&((s=navigator.userAgent).includes("Firefox")?this.B=4:s.includes("Chrome")&&(this.B=200)),this.t||(this.t="decompressionstream")),this.D=new Uint8Array(0),this.S=new DataView(this.D.buffer,this.D.byteOffset,this.D.length),this.T=new Uint8Array(12e3),this.j=new DataView(this.T.buffer,this.T.byteOffset,this.T.length),this.U=0,this.I=t.atomTable??{true:!0,false:!1,undefined:void 0,null:null,h:null,V:NaN,k:1/0,O:1/0,q:-1/0};const n=new TextEncoder;this.C=Object.entries(this.I).reduce((t,i)=>{var[s,h]=i;let e=t[s.length]??=[];for(let t=0;t<s.length;t++){var r=s.charCodeAt(t);e=e[r]??=t===s.length-1?h:[]}return t},[]),this.F=Object.entries(this.I).reduce((t,i)=>{var[i,s]=i,h=n.encode(i);let e=t[h.length]??=[];for(let t=0;t<h.length;t++){var r=h[t];e=e[r]??=t===h.length-1?s:[]}return t},[])}unpack(t){var i=131===t[0]?1:0;if(80===t[i]){var s=(t[1+i]<<24)+(t[2+i]<<16)+(t[3+i]<<8)+t[4+i];const e=t.subarray(5+i,5+i+s);if("zlib"===this.t)return s=require("zlib").inflateSync(e),this.unpack(s);if("decompressionstream"===this.t){var h=(s=new DecompressionStream("deflate")).readable.getReader();const r=s.writable.getWriter();return r.ready.then(()=>r.write(e)).then(()=>r.ready).then(()=>r.close()),this.N(h).then(t=>this.unpack(t))}if("function"==typeof this.t)return(s=this.t(e))instanceof Promise?s.then(t=>this.unpack(t)):this.unpack(s)}return this.U=i,t.length<=this.T.length?(this.T.set(t),this.D=this.T,this.S=this.j):(this.D=t,this.S=new DataView(t.buffer,t.byteOffset,t.length)),this.P()}P(){var h=this.D[this.U++];switch(h){case 70:var s=this.S.getFloat64(this.U);return this.U+=8,s;case 97:return this.D[this.U++];case 98:s=this.S.getInt32(this.U);return this.U+=4,s;case 100:case 115:case 118:case 119:s=100===h||118===h?(this.D[this.U++]<<8)+this.D[this.U++]:this.D[this.U++];return this.G(s,h<118);case 104:case 105:case 108:{let i;104===h?i=this.D[this.U++]:(i=this.S.getUint32(this.U),this.U+=4);var e=Array(i);for(let t=0;t<i;t++)e[t]=this.P();return 108===h&&(106===this.D[this.U]?this.U++:e.push(this.P())),e}case 106:return 2===this.i?[]:null;case 107:case 109:case 77:{let i,t;if(107===h?(i=(this.D[this.U++]<<8)+this.D[this.U++],t=this.o):109===h?(i=this.S.getUint32(this.U),t=this.u,this.U+=4):(i=this.S.getUint32(this.U),t=this.l,s=this.D[this.U+4],n=this.D[this.U+i-1],this.D[this.U+i-1]=n>>8-s,this.U+=5),5!==t)return 2<t?(n=this.D.subarray(this.U,this.U+i),this.U+=i,(s=3===t?Buffer.allocUnsafe(i):new Uint8Array(i)).set(n),s):2===t?this.H(i):this.J(i);var r=Array(i);for(let t=0;t<i;t++)r[t]=this.D[this.U+t];return this.U+=i,r}case 110:case 111:{let i;if(110===h?i=this.D[this.U++]:(i=this.S.getUint32(this.U),this.U+=4),0===i)return this.U+=1,3===this.v?"0":1===this.v?0:0n;if(1===i&&0===this.D[this.U+1])return this.U+=2,3===this.v?"0":1===this.v?0:0n;var n=this.D[this.U++];if(i<7||7===i&&this.D[this.U+6]<32){let t=0;return t=1===i?this.D[this.U]:2===i?(this.D[this.U+1]<<8)+this.D[this.U]:3===i?(this.D[this.U+2]<<16)+(this.D[this.U+1]<<8)+this.D[this.U]:4===i?this.S.getUint32(this.U,!0):5===i?4294967296*this.D[this.U+4]+this.S.getUint32(this.U,!0):6===i?4294967296*((this.D[this.U+5]<<8)+this.D[this.U+4])+this.S.getUint32(this.U,!0):4294967296*((this.D[this.U+6]<<16)+(this.D[this.U+5]<<8)+this.D[this.U+4])+this.S.getUint32(this.U,!0),this.U+=i,n&&(t=-t),3===this.v?t.toString():1===this.v?t:BigInt(t)}let s;if(8===i)s=this.S.getBigUint64(this.U,!0);else{let t=i;for(s=0n;0<t;)8<=t?s=(s<<=64n)+this.S.getBigUint64(this.U+(t-=8),!0):4<=t?s=(s<<=32n)+BigInt(this.S.getUint32(this.U+(t-=4),!0)):2<=t?s=(s<<=16n)+BigInt(this.S.getUint16(this.U+(t-=2),!0)):(s=(s<<=8n)+BigInt(this.D[this.U]),t--)}return this.U+=i,n&&(s=-s),2===this.g?s.toString():s}case 116:var i={},a=this.S.getUint32(this.U);this.U+=4;for(let t=0;t<a;t++)i[this.P()]=this.P();return i}throw console.log(this.D.slice(this.U-20,this.U+20)),new Error("Unexpected byte: "+h)}G(h,t){var e=t?this.F:this.C;if(h in e){let i=e[h],s=this.U;for(let t=0;t<h;t++){var r=this.D[s++];if(!(r in i))break;if(t===h-1)return this.U+=h,i[r];i=i[r]}}return this.p?this._(h,t):t?this.J(h):this.H(h)}_(i,s){var t=s?this.F:this.C;i in t||(t[i]=[]);let h=t[i],e=this.U;for(let t=0;t<i;t++){var r=this.D[e++];h=r in h?h[r]:t===i-1?h[r]=s?this.J(i):this.H(i):h[r]=[]}return this.I[h]=h}J(t){let i="",s=this.U;var h=this.D;if(t<this.B)for(var e=s+t;s<e;){var r=this.D[s++];r<128?i+=String.fromCharCode(r):r<224?i+=String.fromCharCode(((31&r)<<6)+(63&h[s++])):r<240?i+=String.fromCharCode(((15&r)<<12)+((63&h[s++])<<6)+(63&h[s++])):(r=((7&r)<<18)+((63&h[s++])<<12)+((63&h[s++])<<6)+(63&h[s++]),i+=String.fromCharCode(55296+(r-65536>>10),55296+(r-65536&1023)))}else i=this.m(h.subarray(s,s+t));return this.U+=t,i}H(i){let s="";var h=this.U,e=this.D;if(i<this.B)for(let t=h;t<h+i;t++)s+=String.fromCharCode(e[t]);else s=this.A(e.subarray(h,h+i));return this.U+=i,s}async N(t){var i=[];let s=0;for(;;){var{done:h,value:e}=await t.read();if(e&&(i.push(e),s+=e.length),h)break}var r=new Uint8Array(s);let n=0;for(let t=0;t<i.length;t++){var a=i[t];r.set(a,n),n+=a.length}return r}}});